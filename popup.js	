document.getElementById("submitBtn").addEventListener("click", async () => {
  const fileInput = document.getElementById("fileInput");
  const output = document.getElementById("output");

  if (!fileInput.files[0]) {
    output.textContent = "⚠️ .txtファイルを選んでください。";
    return;
  }

  const file = fileInput.files[0];
  const text = await file.text();

  output.textContent = "ChatGPTに送信中...";

  const prompt = `
以下は会議の文字起こしです。この内容をもとに、以下のように議事録を作成してください。

先方の会社・弊社の役員に見られる議事録なので粒度は細かくお願いします。
あと先方社内で回してもらっときにわからない部分があったら困るので、誰が見てもちゃんとわかるように書いてください。
また、相手が不快に思わない文章にしてください

顧客との商談や社内MTGの会話内容・議事メモを原文のまま投稿します。
それを社外向けにも提供できるレベルでまとめて議事録を作成してください。
先方のチームや上長がなんの目的でどういう話をしたか一発でわかるようにしてください。
口語は一切使わず文語で作成してください。
またnotionへの貼り付けとなるため、段落を分けるときの余計な線は不要で、なるべく段落も階層が深くなりすぎないように3階層(必要ならば4階層)でとどめてください。
そのまま社外の見込み顧客に送付する議事録なので、顧客が不快にならない文章を徹底してください

いつも先方担当者・先方の上長に見られるとしたら、気になる・不明点が多すぎる点が多すぎるので注意してください

上司が作った顧客にも送るレベルの議事録は下記です。
下記を参考にして作ってください。

1. 日時・場所
    1. 11/22 (金) 千葉ロッテマリーンズ社オフィス
2. 参加者
    1. 千葉ロッテマリーンズ社　飯田様（本部長）、岩井様(MD責任者)、吉井様(担当)、木ノ下様（出向）
    2. Firework社　田島、小松
3. 会議目的
    1. MD・コンセッション部様の取り組み状況や課題感をお伺い、どのようにお役立ちできるかイメージを持っていただき、具体的な施策討議の場を次回設定させていただく
4. 議事
    1. 現状共有
        1. 動画活用領域
            1. インフルエンサーを活用した施策を検討しており、2ヶ月前よりテイラーアップ社のSNSフォースを活用する相談を行なってきた。現時点で確定はしていない
            2. Fireworkのソリューションとは活用領域が重複しないため、それぞれを並行して検討していく
        2. MD
            1. 年間約70試合のホームゲームがあり、試合当日リアル店舗での売り上げが中心
            2. MDの中で売上の主となるのはユニフォーム
            3. ECサイトでも同様。但し、人気選手以外は受注型生産となり購買者へのデリバリーが最大2ヶ月かかることも
            4. コアユーザー：開幕前にECで応援している選手のユニフォームを買い、試合観戦当日は他のグッズをリアル店舗で買っている
            5. ライトユーザー：ECで買い物をすることはほぼなく、試合観戦当日に現場の雰囲気で買い物意識が高まりリアル店舗で買っている
            6. 今後は、ECサイトを利用していないコアユーザーやライトユーザーに対して、ECサイトでの購買がリアル店舗での購買のきっかけとなるようなLTVの最大化を目指したい
            7. チャレンジとしては、ECサイトに訪問する動機が開幕前のユニフォーム購買のみに限定されている点＝ECサイトにおける接客が課題
        3. カスタマー
            1. コアユーザー：平均来場回数9.8回 / 70回、ユニフォーム購買数平均 2.2枚
            2. ライトユーザー：平均来場回数1.2回 / 70回
        4. MD戦略
            1. 購買頻度、購買単価、購買者の組み合わせにおいては、購買頻度と購買者をKey Metricsとして考えている
            2. MD購買は観戦が必ず紐づいているため、そのOcasionをキーとして、観戦前、観戦中、観戦後における買い物体験の最大化を検討する
        5. 観戦後の買い物は購買意欲をキープすることが難しいため観戦前、観戦中をベースとする
    2. 討議
        1. 購入機会
            1. 試合当日は試合2時間前開場となるが、開場前から並んでいるユーザーが一定おり、場外ショップでの購買の機会がある
            2. 整理すると、試合前＝自宅からスタジアム開場まで、開場してから試合開始までの2ポイント
        2. カスタマー
            1. 来場者あたりグッズを購入するのは最大で2割
            2. 1試合平均来場者は24,000人
            3. 非購入者は1試合あたり約20,000人、年間で述べ140万人が試合観戦しているがグッズを購入していない
            4. この140万人をターゲットカスタマーとして、オンライン、オフラインにおけるタッチポイントを整備することで楽しい買い物体験を提供できないか
        3. タッチポイント
            1. 現時点では様々な発表は公式サイトで行なっている、ユニフォームの販促は選手のSNSで紹介してもらいECサイトに誘導する、など統制が取れていないため、全体整備した上でコミュニケーション上動画が有効な部分をライブ配信やショート動画で実施できると効果が上がりそう
5. ネクストステップ
    1. 11月26日(火)に来季戦略をまとめる予定があるため、今回のミーティング結果をまとめた内容を基にした計画の骨子と突合してディスカッションできると良い
--- 会議ログ ---
${text}
`;

  const response = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": `Bearer ${OPENAI_API_KEY}`
    },
    body: JSON.stringify({
      model: "gpt-4",
      messages: [{ role: "user", content: prompt }],
      temperature: 0.4
    })
  });

  const result = await response.json();
  const summary = result.choices[0].message.content;

  output.textContent = summary;
});
